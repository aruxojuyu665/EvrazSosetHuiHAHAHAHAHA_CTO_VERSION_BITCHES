# План комплексного тестирования RAG системы

**Дата:** 30 октября 2025  
**Версия:** 0.2.1  
**Цель:** Комплексная проверка функциональности, надежности и производительности RAG системы

---

## Типы тестирования

### 1. Unit тесты (Модульное тестирование)
Проверка отдельных компонентов системы в изоляции.

#### 1.1 Тесты конфигурации (`test_config.py`)
- ✅ Безопасная конвертация int/float
- ✅ Валидация API ключей
- ✅ Значения по умолчанию
- **Статус:** Реализовано (10 тестов)

#### 1.2 Тесты Milvus менеджера (`test_milvus_manager.py`)
- [ ] Подключение к Milvus
- [ ] Создание коллекции
- [ ] Проверка существования коллекции
- [ ] Получение статистики
- [ ] Context manager
- [ ] Обработка ошибок подключения
- **Статус:** Требует реализации

#### 1.3 Тесты RAG системы (`test_rag_system.py`)
- [ ] Инициализация компонентов
- [ ] Настройка LLM
- [ ] Настройка embeddings
- [ ] Загрузка документов
- [ ] Создание индекса
- [ ] Выполнение запросов
- [ ] Retry логика
- **Статус:** Частично реализовано

#### 1.4 Тесты утилит (`test_utils.py`)
- [ ] Retry декоратор
- [ ] Обработка исключений
- [ ] Exponential backoff
- **Статус:** Требует создания

---

### 2. Integration тесты (Интеграционное тестирование)
Проверка взаимодействия компонентов.

#### 2.1 Тест полного цикла индексирования
- [ ] Загрузка PDF документа
- [ ] Chunking текста
- [ ] Создание embeddings
- [ ] Сохранение в Milvus
- [ ] Проверка количества векторов
- **Статус:** Требует реализации

#### 2.2 Тест полного цикла запроса
- [ ] Загрузка существующего индекса
- [ ] Выполнение векторного поиска
- [ ] Генерация ответа через LLM
- [ ] Проверка структуры ответа
- **Статус:** Требует реализации

#### 2.3 Тест извлечения информации о классе прочности
- [ ] Запрос информации о C235
- [ ] Проверка наличия ключевых данных
- [ ] Сохранение результата в JSON
- **Статус:** Требует реализации

---

### 3. End-to-End тесты (Сквозное тестирование)
Проверка работы системы от начала до конца.

#### 3.1 Тест CLI команды `index`
- [ ] Индексирование тестового документа
- [ ] Проверка успешного завершения
- [ ] Проверка логов
- **Статус:** Требует реализации

#### 3.2 Тест CLI команды `query`
- [ ] Выполнение запроса через CLI
- [ ] Проверка формата вывода
- [ ] Сохранение в файл
- **Статус:** Требует реализации

#### 3.3 Тест CLI команды `extract`
- [ ] Извлечение информации о классе прочности
- [ ] Проверка JSON файла
- **Статус:** Требует реализации

#### 3.4 Тест CLI команды `stats`
- [ ] Получение статистики
- [ ] Проверка формата вывода
- **Статус:** Требует реализации

---

### 4. Performance тесты (Тестирование производительности)
Проверка производительности и масштабируемости.

#### 4.1 Тест скорости индексирования
- [ ] Измерение времени индексирования 1 документа
- [ ] Измерение времени индексирования 10 документов
- [ ] Проверка использования памяти
- **Целевые показатели:**
  - 1 документ (10 страниц): < 2 минуты
  - 10 документов: < 15 минут
  - Использование RAM: < 4 GB

#### 4.2 Тест скорости запросов
- [ ] Измерение времени простого запроса
- [ ] Измерение времени сложного запроса
- [ ] Проверка latency
- **Целевые показатели:**
  - Простой запрос: 2-5 секунд
  - Сложный запрос: 5-10 секунд
  - Latency: < 500ms для векторного поиска

#### 4.3 Тест нагрузки
- [ ] 10 последовательных запросов
- [ ] 50 последовательных запросов
- [ ] Проверка стабильности
- **Целевые показатели:**
  - Без ошибок
  - Стабильное время ответа

---

### 5. Stress тесты (Нагрузочное тестирование)
Проверка поведения при экстремальных условиях.

#### 5.1 Тест больших документов
- [ ] Индексирование документа > 100 страниц
- [ ] Проверка использования памяти
- [ ] Проверка времени обработки
- **Статус:** Требует реализации

#### 5.2 Тест большого количества запросов
- [ ] 100+ запросов подряд
- [ ] Проверка утечек памяти
- [ ] Проверка стабильности соединений
- **Статус:** Требует реализации

---

### 6. Error Handling тесты (Тестирование обработки ошибок)
Проверка корректной обработки ошибок.

#### 6.1 Тест невалидных входных данных
- [ ] Несуществующий файл
- [ ] Пустой запрос
- [ ] Невалидный класс прочности
- **Статус:** Требует реализации

#### 6.2 Тест сетевых ошибок
- [ ] Недоступность Milvus
- [ ] Timeout API
- [ ] Rate limit API
- **Статус:** Требует реализации

#### 6.3 Тест retry логики
- [ ] Временный сбой API
- [ ] Проверка количества попыток
- [ ] Проверка exponential backoff
- **Статус:** Требует реализации

---

### 7. Security тесты (Тестирование безопасности)
Проверка безопасности системы.

#### 7.1 Тест конфиденциальности API ключей
- [ ] Проверка, что ключи не логируются
- [ ] Проверка, что ключи не в git
- **Статус:** Требует реализации

#### 7.2 Тест валидации входных данных
- [ ] SQL injection в запросах
- [ ] Path traversal в путях к файлам
- **Статус:** Требует реализации

---

### 8. Docker тесты
Проверка Docker конфигурации.

#### 8.1 Тест сборки образа
- [ ] Успешная сборка Dockerfile
- [ ] Проверка размера образа
- [ ] Проверка слоев
- **Целевой размер:** < 2 GB

#### 8.2 Тест docker-compose
- [ ] Запуск всех сервисов
- [ ] Проверка сетевого взаимодействия
- [ ] Проверка volumes
- **Статус:** Требует реализации

---

## Приоритеты тестирования

### Высокий приоритет (P0)
1. Unit тесты для критических компонентов
2. Integration тест полного цикла
3. E2E тесты CLI команд
4. Error handling для основных сценариев

### Средний приоритет (P1)
1. Performance тесты
2. Docker тесты
3. Security тесты базовые

### Низкий приоритет (P2)
1. Stress тесты
2. Advanced security тесты

---

## Тестовые данные

### Документы для тестирования
1. **GOST_27772-2021.pdf** - основной документ (уже есть)
2. **test_small.pdf** - маленький документ (1-2 страницы) - создать
3. **test_large.pdf** - большой документ (100+ страниц) - создать

### Тестовые запросы
1. "Что такое класс прочности C235?"
2. "Какие механические свойства у стали C235?"
3. "Перечисли все классы прочности в документе"
4. "Какой химический состав у класса C345?"

---

## Метрики успеха

### Покрытие кода
- **Целевое покрытие:** > 80%
- **Критические модули:** > 90%

### Успешность тестов
- **Unit тесты:** 100% pass
- **Integration тесты:** 100% pass
- **E2E тесты:** 100% pass

### Производительность
- **Индексирование:** < 2 мин/документ
- **Запросы:** 2-7 секунд
- **Использование RAM:** < 4 GB

---

## Инструменты тестирования

### Фреймворки
- **pytest** - основной фреймворк
- **pytest-cov** - покрытие кода
- **pytest-mock** - моки
- **pytest-asyncio** - асинхронные тесты

### Утилиты
- **coverage** - анализ покрытия
- **locust** - нагрузочное тестирование
- **docker-compose** - интеграционные тесты

---

## План выполнения

### День 1: Unit тесты
- [x] test_config.py (уже есть)
- [ ] test_milvus_manager.py
- [ ] test_rag_system.py (улучшить)
- [ ] test_utils.py

### День 2: Integration и E2E тесты
- [ ] test_integration.py
- [ ] test_e2e_cli.py
- [ ] test_docker.py

### День 3: Performance и Error Handling
- [ ] test_performance.py
- [ ] test_error_handling.py
- [ ] test_security.py

### День 4: Исправление багов и оптимизация
- [ ] Анализ результатов
- [ ] Исправление найденных багов
- [ ] Оптимизация медленных участков

---

## Отчетность

### Формат отчета
- Общая статистика тестов
- Детальные результаты по каждому типу
- Найденные баги и их статус
- Метрики производительности
- Рекомендации по улучшению

### Файлы отчетов
- `TESTING_REPORT.md` - основной отчет
- `coverage_report.html` - отчет покрытия
- `performance_metrics.json` - метрики производительности
